

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>3. Advanced Descriptor Usage &mdash; A User&#39;s Guide to Descriptors 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/todo-styles.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="A User&#39;s Guide to Descriptors 1.0.0 documentation" href="index.html" />
    <link rel="next" title="4. Writing and Adding New Descriptors" href="coding.html" />
    <link rel="prev" title="2. Basic Descriptor Usage" href="basicusage.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="coding.html" title="4. Writing and Adding New Descriptors"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="basicusage.html" title="2. Basic Descriptor Usage"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">A User&#39;s Guide to Descriptors 1.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="advanced-descriptor-usage">
<span id="id1"></span><h1>3. Advanced Descriptor Usage<a class="headerlink" href="#advanced-descriptor-usage" title="Permalink to this headline">¶</a></h1>
<div class="section" id="descriptorvalue">
<h2>3.1. DescriptorValue<a class="headerlink" href="#descriptorvalue" title="Permalink to this headline">¶</a></h2>
<p>When a descriptor is called, what is actually returned is a <tt class="docutils literal"><span class="pre">DescriptorValue</span></tt>
(<tt class="docutils literal"><span class="pre">DV</span></tt>) object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astrodata</span> <span class="kn">import</span> <span class="n">AstroData</span>
<span class="go"># Load the fits file into AstroData</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ad</span> <span class="o">=</span> <span class="n">AstroData</span><span class="p">(</span><span class="s">&quot;N20091027S0137.fits&quot;</span><span class="p">)</span>
<span class="go"># Get the airmass value using the airmass descriptor</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">airmass</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">airmass</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">airmass</span>
<span class="go">1.327</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">airmass</span><span class="p">)</span>
<span class="go">&lt;class &#39;astrodata.Descriptors.DescriptorValue&#39;&gt;</span>
</pre></div>
</div>
<p>Each descriptor has a default Python type defined:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">ad</span><span class="o">.</span><span class="n">airmass</span><span class="p">()</span><span class="o">.</span><span class="n">pytype</span>
<span class="go">&lt;type &#39;float&#39;&gt;</span>
</pre></div>
</div>
<p>If any of the following operations are applied to the <tt class="docutils literal"><span class="pre">DV</span></tt> object, the <tt class="docutils literal"><span class="pre">DV</span></tt>
object is automatically cast to the default Python type for that descriptor:</p>
<div class="highlight-python"><pre>+   -   *   /   //   %   **   &lt;&lt;   &gt;&gt;   ^   &lt;   &lt;=   &gt;   &gt;=   ==</pre>
</div>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">airmass</span><span class="o">*</span><span class="mf">1.0</span><span class="p">)</span>
<span class="go">&lt;type &#39;float&#39;&gt;</span>
</pre></div>
</div>
<p>The value of the descriptor can be retrieved with the default Python type by
using <tt class="docutils literal"><span class="pre">as_pytype()</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">elevation</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">elevation</span><span class="p">()</span><span class="o">.</span><span class="n">as_pytype</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">elevation</span>
<span class="go">48.6889222222</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">elevation</span><span class="p">)</span>
<span class="go">&lt;type &#39;float&#39;&gt;</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">as_pytype()</span></tt> member function of the <tt class="docutils literal"><span class="pre">DV</span></tt> object should only be
required when the <tt class="docutils literal"><span class="pre">DV</span></tt> object can not be automatically cast to it&#8217;s default
Python type. For example, when it is necessary to use the actual value of a
descriptor (e.g., string, float, etc.) rather than a <tt class="docutils literal"><span class="pre">DV</span></tt> object as a key of
a Python dictionary, the <tt class="docutils literal"><span class="pre">DV</span></tt> object can be cast to it&#8217;s default Python type
using <tt class="docutils literal"><span class="pre">as_pytype()</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">my_key</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">gain_setting</span><span class="o">.</span><span class="n">as_pytype</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_value</span> <span class="o">=</span> <span class="n">my_dict</span><span class="p">[</span><span class="n">my_key</span><span class="p">]</span>
</pre></div>
</div>
<p>If an alternative Python type is required for whatever reason, the <tt class="docutils literal"><span class="pre">DV</span></tt>
object can be cast to the appropriate Python type as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">elevation_as_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ad</span><span class="o">.</span><span class="n">elevation</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">elevation_as_int</span>
<span class="go">48</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">elevation_as_int</span><span class="p">)</span>
<span class="go">&lt;type &#39;int&#39;&gt;</span>
</pre></div>
</div>
<p>When using operations with a <tt class="docutils literal"><span class="pre">DV</span></tt> object and a numpy object, care must be
taken. Consider the following cases:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ad</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">/</span> <span class="n">ad</span><span class="o">.</span><span class="n">gain</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ad</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">/</span> <span class="n">ad</span><span class="o">.</span><span class="n">gain</span><span class="p">()</span><span class="o">.</span><span class="n">as_pytype</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ad</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">/</span> <span class="mf">12.345</span>
</pre></div>
</div>
<p>All the above commands return the same result (assuming that ad.gain() =
12.345). However, the first command is extremely slow while the second and
third commands are fast. In the first case, since both operands have overloaded
operators, the operator from the operand on the left will be used. For some
reason, the <tt class="docutils literal"><span class="pre">__div__</span></tt> operator from the numpy object loops over each pixel in
the numpy object and uses the <tt class="docutils literal"><span class="pre">DV</span></tt> object as an argument, which is very time
consuming. Therefore, the <tt class="docutils literal"><span class="pre">DV</span></tt> object should be cast to an appropriate
Python type before using it in an operation with a numpy object.</p>
<p>In the case where a descriptor returns multiple values (one for each pixel data
extension), a Python dictionary is used to store the values, where the key of
the dictionary is the (&#8220;<tt class="docutils literal"><span class="pre">EXTNAME</span></tt>&#8221;, <tt class="docutils literal"><span class="pre">EXTVER</span></tt>) tuple:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">ad</span><span class="o">.</span><span class="n">gain</span><span class="p">()</span>
<span class="go">{(&#39;SCI&#39;, 2): 2.3370000000000002, (&#39;SCI&#39;, 1): 2.1000000000000001,</span>
<span class="go">(&#39;SCI&#39;, 3): 2.2999999999999998}</span>
</pre></div>
</div>
<p>For those descriptors that describe a concept applying specifically to the
pixel data extensions within a dataset but has the same value for each pixel
data extension will &#8220;act&#8221; as a single value that has a Python type defined by
the default Python type of that descriptor:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">xbin</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">detector_x_bin</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">xbin</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">xbin</span><span class="p">)</span>
<span class="go">&lt;class &#39;astrodata.Descriptors.DescriptorValue&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">xbin</span><span class="o">.</span><span class="n">pytype</span>
<span class="go">&lt;type &#39;int&#39;&gt;</span>
</pre></div>
</div>
<p>If the original value of the descriptor is required, it can be retrieved by
using <tt class="docutils literal"><span class="pre">get_value()</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">xbin</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">detector_x_bin</span><span class="p">()</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">xbin</span>
<span class="go">{(&#39;SCI&#39;, 2): 2, (&#39;SCI&#39;, 1): 2, (&#39;SCI&#39;, 3): 2}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">xbin</span><span class="p">)</span>
<span class="go">&lt;type &#39;dict&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">xbin</span><span class="p">[(</span><span class="s">&quot;SCI&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
<span class="go">2</span>
</pre></div>
</div>
</div>
<div class="section" id="descriptorunits">
<h2>3.2. DescriptorUnits<a class="headerlink" href="#descriptorunits" title="Permalink to this headline">¶</a></h2>
<p>The DescriptorUnits (<tt class="docutils literal"><span class="pre">DU</span></tt>) object provides a way to access and update the
units for a given descriptor. This feature is not yet implemented, but
development is ongoing.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3. Advanced Descriptor Usage</a><ul>
<li><a class="reference internal" href="#descriptorvalue">3.1. DescriptorValue</a></li>
<li><a class="reference internal" href="#descriptorunits">3.2. DescriptorUnits</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="basicusage.html"
                        title="previous chapter">2. Basic Descriptor Usage</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="coding.html"
                        title="next chapter">4. Writing and Adding New Descriptors</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/advancedusage.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="coding.html" title="4. Writing and Adding New Descriptors"
             >next</a> |</li>
        <li class="right" >
          <a href="basicusage.html" title="2. Basic Descriptor Usage"
             >previous</a> |</li>
        <li><a href="index.html">A User&#39;s Guide to Descriptors 1.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Emma Hogan.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>