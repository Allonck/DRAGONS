

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4. Writing and Adding New Descriptors &mdash; A User&#39;s Guide to Descriptors 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/todo-styles.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="A User&#39;s Guide to Descriptors 1.0.0 documentation" href="index.html" />
    <link rel="next" title="A Complete List of Available Descriptors" href="appendices/appendixA.html" />
    <link rel="prev" title="3. Advanced Descriptor Usage" href="advancedusage.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="appendices/appendixA.html" title="A Complete List of Available Descriptors"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="advancedusage.html" title="3. Advanced Descriptor Usage"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">A User&#39;s Guide to Descriptors 1.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="writing-and-adding-new-descriptors">
<span id="writing-adding"></span><h1>4. Writing and Adding New Descriptors<a class="headerlink" href="#writing-and-adding-new-descriptors" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview-of-the-descriptor-code">
<h2>4.1. Overview of the Descriptor Code<a class="headerlink" href="#overview-of-the-descriptor-code" title="Permalink to this headline">¶</a></h2>
<p>The infrastructure for the descriptor code is located within the <tt class="docutils literal"><span class="pre">astrodata</span></tt>
subpackage in the <tt class="docutils literal"><span class="pre">gemini_python</span></tt> package. In addition, a default set of
descriptors that access FITS standard keywords is provided by <tt class="docutils literal"><span class="pre">astrodata</span></tt>.
This code is generic and is not Gemini specific.</p>
<p>The Gemini descriptor code is contained within the <tt class="docutils literal"><span class="pre">astrodata_Gemini</span></tt> addon
in the <tt class="docutils literal"><span class="pre">gemini_python</span></tt> package. The Gemini descriptors inherit the FITS
descriptors, since the Gemini telescopes produce files in FITS format. Other
telescope / instrument addons can exist, enabling the addition of descriptors
from non-Gemini instruments.</p>
<p>The following sections will refer specifically to adding descriptors to the
already existing Gemini descriptor code contained within the
<tt class="docutils literal"><span class="pre">astrodata_Gemini</span></tt> addon.</p>
</div>
<div class="section" id="overview-of-the-fits-descriptor-code">
<h2>4.2. Overview of the FITS Descriptor Code<a class="headerlink" href="#overview-of-the-fits-descriptor-code" title="Permalink to this headline">¶</a></h2>
<p>The FITS descriptors provide access to those keywords that are part of the FITS
standard. There are currently 53 keywords defined in the FITS standard
(<a class="reference external" href="http://heasarc.gsfc.nasa.gov/docs/fcg/standard_dict.html">http://heasarc.gsfc.nasa.gov/docs/fcg/standard_dict.html</a>). There are four FITS
descriptors available that return the value of the corresponding FITS standard
keywords in the PHU of the AstroData object:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">instrument</span> <span class="pre">[INSTRUME]</span></tt></li>
<li><tt class="docutils literal"><span class="pre">object</span> <span class="pre">[OBJECT]</span></tt></li>
<li><tt class="docutils literal"><span class="pre">telescope</span> <span class="pre">[TELESCOP]</span></tt></li>
<li><tt class="docutils literal"><span class="pre">ut_date</span> <span class="pre">[DATE-OBS]</span></tt></li>
</ul>
</div></blockquote>
<p>The FITS descriptor code is currently located in the <tt class="docutils literal"><span class="pre">gemini_python</span></tt> package
in the <tt class="docutils literal"><span class="pre">astrodata_FITS/ADCONFIG_FITS/descriptors</span></tt> directory [NOTE: the
<tt class="docutils literal"><span class="pre">astrodata_FITS</span></tt> directory will be moved to the <tt class="docutils literal"><span class="pre">astrodata</span></tt> directory in
the near future]:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">calculatorIndex.FITS.py</span></tt></li>
<li><tt class="docutils literal"><span class="pre">CalculatorInterface_FITS.py</span></tt></li>
<li><tt class="docutils literal"><span class="pre">DescriptorsList_FITS.py</span></tt></li>
<li><tt class="docutils literal"><span class="pre">docstrings.py</span></tt></li>
<li><tt class="docutils literal"><span class="pre">FITS_Descriptors.py</span></tt></li>
<li><tt class="docutils literal"><span class="pre">FITS_Keywords.py</span></tt></li>
</ul>
</div></blockquote>
<p>The function of each of these files is the same as the corresponding files in
the Gemini descriptor code and will be described in the following sections.</p>
</div>
<div class="section" id="overview-of-the-gemini-descriptor-code">
<h2>4.3. Overview of the Gemini Descriptor Code<a class="headerlink" href="#overview-of-the-gemini-descriptor-code" title="Permalink to this headline">¶</a></h2>
<p>The Gemini descriptors provide access to keywords available in the headers of
Gemini data.</p>
<p>The Gemini descriptor code is located in the <tt class="docutils literal"><span class="pre">gemini_python</span></tt> package in the
<tt class="docutils literal"><span class="pre">astrodata_Gemini/ADCONFIG_Gemini/descriptors</span></tt> directory. When writing and
adding new Gemini descriptors, a developer will require knowledge of the
following files:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">calculatorIndex.GEMINI.py</span></tt></li>
<li><tt class="docutils literal"><span class="pre">CalculatorInterface_GEMINI.py</span></tt></li>
<li><tt class="docutils literal"><span class="pre">GEMINI_Descriptors.py</span></tt></li>
<li><tt class="docutils literal"><span class="pre">GEMINI_Keywords.py</span></tt></li>
<li><tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;/&lt;INSTRUMENT&gt;_Descriptors.py</span></tt></li>
<li><tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;/&lt;INSTRUMENT&gt;_Keywords.py</span></tt></li>
</ul>
</div></blockquote>
<p>The following files are required to create the
<tt class="docutils literal"><span class="pre">CalculatorInterface_GEMINI.py</span></tt> file:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">astrodata/scripts/mkCalculatorInterface</span></tt></li>
<li><tt class="docutils literal"><span class="pre">DescriptorsList_GEMINI.py</span></tt></li>
<li><tt class="docutils literal"><span class="pre">docstrings.py</span></tt></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="introduction-to-the-gemini-descriptor-code">
<h2>4.4. Introduction to the Gemini Descriptor Code<a class="headerlink" href="#introduction-to-the-gemini-descriptor-code" title="Permalink to this headline">¶</a></h2>
<p>When a descriptor is called (as described in the <a class="reference internal" href="basicusage.html#basic-descriptor-usage"><em>Basic Descriptor Usage</em></a> section and the <a class="reference internal" href="advancedusage.html#advanced-descriptor-usage"><em>Advanced Descriptor Usage</em></a> section), the CalculatorInterface class (<tt class="docutils literal"><span class="pre">CI</span></tt>)
is accessed, which is either contained in the module
<tt class="docutils literal"><span class="pre">CalculatorInterface_GEMINI.py</span></tt> or, if this module doesn&#8217;t exist, is
automatically generated and stored in memory. The <tt class="docutils literal"><span class="pre">CI</span></tt> contains a function
for each available descriptor (see <a class="reference internal" href="appendices/appendixB.html#appendix-ci"><em>Appendix B</em></a> for an
example function). These functions attempt to determine a value for the
descriptor by performing the following steps:</p>
<blockquote>
<div><ul class="simple">
<li>First, depending on the AstroData Type of the AstroData object, a single
set of keywords and a single set of descriptor functions are determined via
inheritance from the keyword files (<tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;_Keywords.py</span></tt>,
<tt class="docutils literal"><span class="pre">GEMINI_Keywords.py</span></tt> and <tt class="docutils literal"><span class="pre">FITS_Keywords.py</span></tt>) and the descriptor files
(<tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;_Descriptor.py</span></tt>, <tt class="docutils literal"><span class="pre">GEMINI_Descriptor.py</span></tt> and
<tt class="docutils literal"><span class="pre">FITS_Descriptor.py</span></tt>), respectively, with the files at the start of
each list taking precedence over files later in the list.</li>
<li>If a descriptor function exists in the single set of descriptor functions
determined in the first step for the descriptor being called, then that
descriptor function is used to determine the value of the descriptor.</li>
<li>If no descriptor function is found, the value of a keyword in the PHU of
the AstroData object is returned as the value of the descriptor, where the
keyword is the one directly associated to the descriptor and is contained
in the single set of keywords determined in the first step.</li>
<li>If a value for the descriptor is returned, either from a descriptor
function or directly from the PHU of the AstroData object, a
DescriptorValue (<tt class="docutils literal"><span class="pre">DV</span></tt>) object is instantiated (which contains the value
of the descriptor) and returns this to the user.</li>
<li>If a value for the descriptor is not found, an exception is raised (see the
<a class="reference internal" href="#descriptor-exceptions"><em>Descriptor Exceptions</em></a> section).</li>
</ul>
</div></blockquote>
<p>A descriptor function is necessary in the cases where the descriptor does more
than simply access a single keyword from the PHU of the AstroData object, e.g.,
if a descriptor requires access to multiple keywords, requires access to
keywords in the pixel data extensions (a dictionary must be returned by the
descriptor function, where the key is the (&#8220;<tt class="docutils literal"><span class="pre">EXTNAME</span></tt>&#8221;, <tt class="docutils literal"><span class="pre">EXTVER</span></tt>) tuple)
and / or requires some validation.</p>
</div>
<div class="section" id="description-of-the-files-used-in-the-gemini-descriptor-code">
<h2>4.5. Description of the files used in the Gemini Descriptor Code<a class="headerlink" href="#description-of-the-files-used-in-the-gemini-descriptor-code" title="Permalink to this headline">¶</a></h2>
<div class="section" id="calculatorindex-gemini-py">
<span id="id1"></span><h3>4.5.1. <tt class="docutils literal"><span class="pre">calculatorIndex.GEMINI.py</span></tt><a class="headerlink" href="#calculatorindex-gemini-py" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">calculatorIndex.GEMINI.py</span></tt> file contains a Python dictionary named
<tt class="docutils literal"><span class="pre">calculatorIndex</span></tt> and is used to define which Python object (i.e., the
descriptor class that defines the descriptor functions, in the form
<tt class="docutils literal"><span class="pre">&lt;module_name&gt;.&lt;calculator_class_name&gt;</span></tt>) to use as the calculator for a given
<tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">calculatorIndex</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">&quot;&lt;INSTRUMENT&gt;&quot;</span><span class="p">:</span><span class="s">&quot;&lt;INSTRUMENT&gt;_Descriptors.&lt;INSTRUMENT&gt;_DescriptorCalc()&quot;</span><span class="p">,</span>
  <span class="p">}</span>
</pre></div>
</div>
<p>When adding descriptors for a new, undefined instrument, an appropriate entry
must be added to the <tt class="docutils literal"><span class="pre">calculatorIndex</span></tt> dictionary in the
<tt class="docutils literal"><span class="pre">calculatorIndex.GEMINI.py</span></tt> file as shown above.</p>
</div>
<div class="section" id="calculatorinterface-gemini-py">
<h3>4.5.2. <tt class="docutils literal"><span class="pre">CalculatorInterface_GEMINI.py</span></tt><a class="headerlink" href="#calculatorinterface-gemini-py" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">CalculatorInterface_GEMINI.py</span></tt> module contains the CalculatorInterface
class (<tt class="docutils literal"><span class="pre">CI</span></tt>), which contains a function for each available descriptor (see
<a class="reference internal" href="appendices/appendixB.html#appendix-ci"><em>Appendix B</em></a> for an example function). The
<tt class="docutils literal"><span class="pre">CalculatorInterface_GEMINI.py</span></tt> module is automatically generated by the
<tt class="docutils literal"><span class="pre">mkCalculatorInterface</span></tt> script, which is located in <tt class="docutils literal"><span class="pre">astrodata/scripts</span></tt>
directory. Therefore, the <tt class="docutils literal"><span class="pre">CalculatorInterface_GEMINI.py</span></tt> module should never
be edited directly. If the <tt class="docutils literal"><span class="pre">CalculatorInterface_GEMINI.py</span></tt> module does not
exist, the <tt class="docutils literal"><span class="pre">CI</span></tt> is automatically generated and stored in memory.</p>
</div>
<div class="section" id="gemini-keywords-py">
<h3>4.5.3. <tt class="docutils literal"><span class="pre">GEMINI_Keywords.py</span></tt><a class="headerlink" href="#gemini-keywords-py" title="Permalink to this headline">¶</a></h3>
<p>The Gemini specific keyword file <tt class="docutils literal"><span class="pre">GEMINI_Keywords.py</span></tt> contains a Python
dictionary named <tt class="docutils literal"><span class="pre">GEMINI_KeyDict</span></tt>, where the key is a variable in the form
<tt class="docutils literal"><span class="pre">key_&lt;descriptor&gt;</span></tt> and the value is the keyword directly associated to the
descriptor <tt class="docutils literal"><span class="pre">&lt;descriptor&gt;</span></tt>:</p>
<div class="highlight-python"><pre>GEMINI_KeyDict = {
  "key_airmass":"AIRMASS",
  ...
  "key_camera":"CAMERA",
  ...
  }</pre>
</div>
<p>As shown above, the <tt class="docutils literal"><span class="pre">AIRMASS</span></tt> keyword is associated to the <tt class="docutils literal"><span class="pre">airmass</span></tt>
descriptor via the variable <tt class="docutils literal"><span class="pre">key_airmass</span></tt>. When the <tt class="docutils literal"><span class="pre">airmass</span></tt> descriptor is
called, the value of the single keyword <tt class="docutils literal"><span class="pre">AIRMASS</span></tt> in the PHU of the AstroData
object is returned.</p>
<p>If a descriptor function in the Gemini specific descriptor file
<tt class="docutils literal"><span class="pre">GEMINI_Descriptors.py</span></tt> requires access to additional keywords, appropriate
variables must be defined in the <tt class="docutils literal"><span class="pre">GEMINI_KeyDict</span></tt> dictionary, so that keyword
names are not hard-coded in the descriptor files, allowing a single variable
to be used consistently by multiple descriptor functions:</p>
<div class="highlight-python"><pre>GEMINI_KeyDict = {
  ...
  "key_pwfs1":"PWFS1_ST",
  ...
  }</pre>
</div>
</div>
<div class="section" id="gemini-descriptors-py">
<h3>4.5.4. <tt class="docutils literal"><span class="pre">GEMINI_Descriptors.py</span></tt><a class="headerlink" href="#gemini-descriptors-py" title="Permalink to this headline">¶</a></h3>
<p>The Gemini specific descriptor file <tt class="docutils literal"><span class="pre">GEMINI_Descriptors.py</span></tt> contains
descriptor functions that apply to all Gemini data.</p>
</div>
<div class="section" id="instrument-keywords-py">
<h3>4.5.5. <tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;_Keywords.py</span></tt><a class="headerlink" href="#instrument-keywords-py" title="Permalink to this headline">¶</a></h3>
<p>The instrument specific keyword files <tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;_Keywords.py</span></tt>, which are
located in the corresponding <tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;</span></tt> directory in the
<tt class="docutils literal"><span class="pre">astrodata_Gemini/ADCONFIG_Gemini/descriptors</span></tt> directory, contain a Python
dictionary named <tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;_KeyDict</span></tt>, where the key is a variable in the
form <tt class="docutils literal"><span class="pre">key_&lt;descriptor&gt;</span></tt> and the value is the keyword directly associated to
the descriptor &lt;descriptor&gt;, and is used to overwrite (via inheritance) any of
the Gemini specific keywords directly associated with the descriptor as defined
in <tt class="docutils literal"><span class="pre">GEMINI_Keywords.py</span></tt>:</p>
<div class="highlight-python"><pre>GMOS_KeyDict = {
  ...
  "key_camera":"INSTRUME",
  ...
  }</pre>
</div>
<p>For GMOS data, the value of the single keyword <tt class="docutils literal"><span class="pre">INSTRUME</span></tt> in the PHU of the
AstroData object is returned when the <tt class="docutils literal"><span class="pre">camera</span></tt> descriptor is called, instead
of the value of the single keyword <tt class="docutils literal"><span class="pre">CAMERA</span></tt>, as defined in the Gemini
specific keyword file <tt class="docutils literal"><span class="pre">GEMINI_Keywords.py</span></tt>.</p>
<p>If a descriptor function in the instrument specific descriptor files
<tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;_Descriptors.py</span></tt> require access to additional keywords,
appropriate variables must be defined in the <tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;_KeyDict</span></tt>
dictionary, so that keyword names are not hard-coded in the descriptor files,
allowing a single variable to be used consistently by multiple descriptor
functions:</p>
<div class="highlight-python"><pre>GMOS_KeyDict = {
  ...
  "key_ccdsum":"CCDSUM",
  ...
  }</pre>
</div>
</div>
<div class="section" id="instrument-descriptors-py">
<h3>4.5.6. <tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;_Descriptors.py</span></tt><a class="headerlink" href="#instrument-descriptors-py" title="Permalink to this headline">¶</a></h3>
<p>The instrument specific descriptor files <tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;_Descriptors.py</span></tt>, which
are located in the corresponding <tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;</span></tt> directory in the
<tt class="docutils literal"><span class="pre">astrodata_Gemini/ADCONFIG_Gemini/descriptors</span></tt> directory, contain descriptor
functions that are specific to <tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;</span></tt> and are used to overwrite (via
inheritance) any of the Gemini specific descriptor functions as defined in
<tt class="docutils literal"><span class="pre">GEMINI_Descriptors.py</span></tt>. An example descriptor function (<tt class="docutils literal"><span class="pre">detector_x_bin</span></tt>)
from <tt class="docutils literal"><span class="pre">GMOS_Descriptors.py</span></tt> can be found in <a class="reference internal" href="appendices/appendixC.html#appendix-descriptor"><em>Appendix C</em></a>.</p>
</div>
<div class="section" id="mkcalculatorinterface">
<h3>4.5.7. <tt class="docutils literal"><span class="pre">mkCalculatorInterface</span></tt><a class="headerlink" href="#mkcalculatorinterface" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">mkCalculatorInterface</span></tt> script is located in the <tt class="docutils literal"><span class="pre">astrodata/scripts</span></tt>
directory and contains the code required to automatically generate the
<tt class="docutils literal"><span class="pre">CalculatorInterface_GEMINI.py</span></tt> module. To create
<tt class="docutils literal"><span class="pre">CalculatorInterface_GEMINI.py</span></tt>, run the following command in the
<tt class="docutils literal"><span class="pre">astrodata_Gemini/ADCONFIG_Gemini/descriptors</span></tt> directory:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">shell</span><span class="o">&gt;</span> <span class="n">mkCalculatorInterface</span> <span class="o">&gt;</span> <span class="n">CalculatorInterface_GEMINI</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">mkCalculatorInterface</span></tt> script uses the information in the
<tt class="docutils literal"><span class="pre">DescriptorsList_GEMINI.py</span></tt> file and the <tt class="docutils literal"><span class="pre">docstrings.py</span></tt> file to create the
<tt class="docutils literal"><span class="pre">CalculatorInterface_GEMINI.py</span></tt> module. This script should be run after
making changes to the <tt class="docutils literal"><span class="pre">DescriptorsList_GEMINI.py</span></tt> file or the
<tt class="docutils literal"><span class="pre">docstrings.py</span></tt> file.</p>
</div>
<div class="section" id="descriptorslist-gemini-py">
<h3>4.5.8. <tt class="docutils literal"><span class="pre">DescriptorsList_GEMINI.py</span></tt><a class="headerlink" href="#descriptorslist-gemini-py" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">DescriptorsList_GEMINI.py</span></tt> file contains a list of Gemini descriptors
and their default Python type:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span>
  <span class="n">DD</span><span class="p">(</span><span class="s">&quot;airmass&quot;</span><span class="p">,</span> <span class="n">pytype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span>
  <span class="o">...</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">DescriptorsList_GEMINI.py</span></tt> file is used by the <tt class="docutils literal"><span class="pre">mkCalculatorInterface</span></tt>
script to generate a function for every descriptor in the
<tt class="docutils literal"><span class="pre">CalculatorInterface_Gemini.py</span></tt> file.</p>
</div>
<div class="section" id="docstrings-py">
<h3>4.5.9. <tt class="docutils literal"><span class="pre">docstrings.py</span></tt><a class="headerlink" href="#docstrings-py" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">docstrings.py</span></tt> file contains a function for every Gemini descriptor (as
listed in the <tt class="docutils literal"><span class="pre">DescriptorsList_GEMINI.py</span></tt> file) where the docstring for each
descriptor can be defined. The <tt class="docutils literal"><span class="pre">docstrings.py</span></tt> file is used by the
<tt class="docutils literal"><span class="pre">mkCalculatorInterface</span></tt> script to include the docstrings for the descriptor
functions in the <tt class="docutils literal"><span class="pre">CalculatorInterface_Gemini.py</span></tt> file.</p>
</div>
</div>
<div class="section" id="how-to-add-a-new-gemini-descriptor">
<h2>4.6. How to add a new Gemini descriptor<a class="headerlink" href="#how-to-add-a-new-gemini-descriptor" title="Permalink to this headline">¶</a></h2>
<p>The following instructions describe how to add a new descriptor to the system.</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">First, check to see whether the new descriptor has the same concept as a
descriptor that already exists (<a class="reference internal" href="appendices/appendixA.html#appendix-typewalk"><em>Appendix A</em></a>). If
a new descriptor is required, edit the <tt class="docutils literal"><span class="pre">DescriptorsList_GEMINI.py</span></tt> file
and add the new descriptor to the list in alphabetical order. Ensure that
the default Python type for the descriptor is defined:</p>
<div class="highlight-python"><pre>[
  ...
  DD("&lt;my_descriptor_name&gt;", pytype=str),
  ...
]</pre>
</div>
</li>
<li><p class="first">Add a function with the same name as the new descriptor to the
<tt class="docutils literal"><span class="pre">docstrings.py</span></tt> file and write a docstring for the new descriptor so
that it can be included in the <tt class="docutils literal"><span class="pre">CalculatorInterface_GEMINI.py</span></tt> file.</p>
</li>
<li><p class="first">Regenerate the <tt class="docutils literal"><span class="pre">CalculatorInterface_GEMINI.py</span></tt> file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">shell</span><span class="o">&gt;</span> <span class="n">mkCalculatorInterface</span> <span class="o">&gt;</span> <span class="n">CalculatorInterface_GEMINI</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</li>
<li><p class="first">If the new descriptor is for a new, undefined <tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;</span></tt>, create an
<tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;</span></tt> directory containing an <tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;_Descriptors.py</span></tt>
file:</p>
<div class="highlight-python"><pre>from GEMINI_Descriptors import GEMINI_DescriptorCalc
from &lt;INSTRUMENT&gt;_Keywords import &lt;INSTRUMENT&gt;_KeyDict

class &lt;INSTRUMENT&gt;_DescriptorCalc(GEMINI_DescriptorCalc):
    # Updating the global key dictionary with the local key dictionary
    # associated with this descriptor class
    _update_stdkey_dict = &lt;INSTRUMENT&gt;_KeyDict</pre>
</div>
<p>and an <tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;_Keywords.py</span></tt> file:</p>
<div class="highlight-python"><pre>&lt;INSTRUMENT&gt;_KeyDict = {}</pre>
</div>
<p>In addition, add an appropriate entry to the <tt class="docutils literal"><span class="pre">calculatorIndex.Gemini.py</span></tt>
file.</p>
</li>
<li><p class="first">If the new descriptor simply returns the value of a single keyword in the
PHU of the AstroData object, check whether the correct keyword is already
defined in the <tt class="docutils literal"><span class="pre">GEMINI_KeyDict</span></tt> dictionary in the keyword file
<tt class="docutils literal"><span class="pre">GEMINI_Keywords.py</span></tt>. If not, add an entry to the
<tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;_KeyDict</span></tt> dictionary in the instrument specific keyword
file <tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;_Keywords.py</span></tt>, specifying the new descriptor and the
associated keyword:</p>
<div class="highlight-python"><pre>&lt;INSTRUMENT&gt;_KeyDict = {
  "key_&lt;my_descriptor_name&gt;":"MYKEYWRD",
}</pre>
</div>
<p>The descriptor can now be tested; go to step 7.</p>
</li>
<li><p class="first">If the new descriptor requires access to multiple keywords, requires
access to keywords in the pixel data extensions and / or requires some
validation, a descriptor function must be created. Depending on the type
of information the new descriptor will provide, edit one of the following
files to include the new descriptor function:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">GEMINI_Descriptor.py</span></tt></li>
<li><tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;_Descriptor.py</span></tt></li>
</ul>
</div></blockquote>
<p>If access to a particular keyword is required, first check the keyword
files (<tt class="docutils literal"><span class="pre">FITS_Keywords.py</span></tt>, <tt class="docutils literal"><span class="pre">GEMINI_Keywords.py</span></tt> and
<tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;_Keywords.py</span></tt>) to see if it has already been defined. If
required, the <tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;_Keywords.py</span></tt> file should be edited to
contain any new keywords required for this new descriptor function.</p>
</li>
<li><p class="first">Test the descriptor:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astrodata</span> <span class="kn">import</span> <span class="n">AstroData</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ad</span> <span class="o">=</span> <span class="n">AstroData</span><span class="p">(</span><span class="s">&quot;N20091027S0137.fits&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">ad</span><span class="o">.&lt;</span><span class="n">my_descriptor_name</span><span class="o">&gt;</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="descriptor-coding-guidelines">
<h2>4.7. Descriptor Coding Guidelines<a class="headerlink" href="#descriptor-coding-guidelines" title="Permalink to this headline">¶</a></h2>
<p>When creating descriptor functions, the guidelines below should be followed:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Return value<ul>
<li>The descriptors will return the correct value, regardless of the data
processing status of the AstroData object.</li>
<li>The descriptors will not write keywords to the headers of the AstroData
object or cache any information, since it is no effort to use the
descriptors to obtain the correct value as and when it is required.</li>
<li>The value of a descriptor can be written to the history, for information
only.</li>
</ul>
</li>
<li>Return value Python type<ul>
<li>The descriptors will always return a <tt class="docutils literal"><span class="pre">DV</span></tt> object to the user.</li>
<li>The <tt class="docutils literal"><span class="pre">DV</span></tt> object is instantiated by the <tt class="docutils literal"><span class="pre">CI</span></tt> for descriptors that
obtain their values directly from the headers of the AstroData object.
For descriptors that obtain their values from the descriptor functions,
the descriptor functions should be coded to return a <tt class="docutils literal"><span class="pre">DV</span></tt> object. The
<tt class="docutils literal"><span class="pre">DV</span></tt> object contains information related to the descriptor, including
the value of the descriptor, the default Python type for that descriptor
and the units of the descriptor.</li>
</ul>
</li>
<li>Keyword access<ul>
<li>The <tt class="docutils literal"><span class="pre">phu_get_key_value</span></tt> and <tt class="docutils literal"><span class="pre">get_key_value</span></tt> AstroData member
functions should be used in the descriptor functions to access keywords
in the PHU and the headers of the pixel data extensions, respectively,
of an AstroData object.</li>
</ul>
</li>
<li>Logging<ul>
<li>Descriptors will not log any messages.</li>
</ul>
</li>
<li>Raising exceptions<ul>
<li>If the value of a descriptor can not be determined for whatever reason,
the descriptor function should raise an exception.</li>
<li>The descriptor functions should never be coded to return None. Instead,
a descriptor function should throw an exception with a message
explaining why a value could not be returned (e.g., if the concept does
not directly apply to the data). An exception thrown from a descriptor
function will be caught by the <tt class="docutils literal"><span class="pre">CI</span></tt>.</li>
</ul>
</li>
<li>Exception rule<ul>
<li>Descriptors should throw exceptions on fatal errors.</li>
<li>Exceptions thrown on fatal errors (e.g., if a descriptor function is not
found in a loaded calculator) should never be caught by the <tt class="docutils literal"><span class="pre">CI</span></tt>. The
high level code, such as a script or a primitive, should catch any
relevant exceptions.</li>
</ul>
</li>
<li>Descriptor names<ul>
<li>Descriptor names will be:<ul>
<li>all lower case</li>
<li>terms separated with &#8220;_&#8221;</li>
<li>not instrument specific</li>
<li>not mode specific, mostly</li>
</ul>
</li>
<li>A descriptor should describe a particular concept and apply for all
instrument modes.</li>
</ul>
</li>
<li>Standard parameters<ul>
<li>Descriptors accept parameters, some with general purposes are
standardized.</li>
<li>It is especially important for descriptor parameters to follow the
Standard Parameter Names
(<a class="reference external" href="http://gdpsg.wikis-internal.gemini.edu/index.php/GDPSG-NamingConventions#Standard_Parameter_Names">http://gdpsg.wikis-internal.gemini.edu/index.php/GDPSG-NamingConventions#Standard_Parameter_Names</a>) as they are front-facing to the user and should
therefore be consistent.</li>
</ul>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="descriptor-exceptions">
<span id="id2"></span><h2>4.8. Descriptor Exceptions<a class="headerlink" href="#descriptor-exceptions" title="Permalink to this headline">¶</a></h2>
<p>When writing descriptor functions, if a descriptor is unable to return a value,
an exception should be raised in the code with an appropriate, explicit error
message, so that it is clear to the user exactly why a value could not be
returned. The exception information is stored in <tt class="docutils literal"><span class="pre">exception_info</span></tt> by the
<tt class="docutils literal"><span class="pre">CI</span></tt> so that a user can access that information, if they wish to do so. A
list of descriptor exceptions can be found in the <tt class="docutils literal"><span class="pre">astrodata/Errors.py</span></tt>
module. These descriptor exceptions inherit from the DescriptorError base class
and are caught by the <tt class="docutils literal"><span class="pre">CI</span></tt>. If the default setting of <tt class="docutils literal"><span class="pre">throwExceptions</span> <span class="pre">=</span>
<span class="pre">False</span></tt> (line 62 in <tt class="docutils literal"><span class="pre">astrodata/Calculator.py</span></tt>), <tt class="docutils literal"><span class="pre">None</span></tt> is returned. During
development, the developer should set <tt class="docutils literal"><span class="pre">throwExceptions</span> <span class="pre">=</span> <span class="pre">True</span></tt> so that
exceptions are thrown.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4. Writing and Adding New Descriptors</a><ul>
<li><a class="reference internal" href="#overview-of-the-descriptor-code">4.1. Overview of the Descriptor Code</a></li>
<li><a class="reference internal" href="#overview-of-the-fits-descriptor-code">4.2. Overview of the FITS Descriptor Code</a></li>
<li><a class="reference internal" href="#overview-of-the-gemini-descriptor-code">4.3. Overview of the Gemini Descriptor Code</a></li>
<li><a class="reference internal" href="#introduction-to-the-gemini-descriptor-code">4.4. Introduction to the Gemini Descriptor Code</a></li>
<li><a class="reference internal" href="#description-of-the-files-used-in-the-gemini-descriptor-code">4.5. Description of the files used in the Gemini Descriptor Code</a><ul>
<li><a class="reference internal" href="#calculatorindex-gemini-py">4.5.1. <tt class="docutils literal"><span class="pre">calculatorIndex.GEMINI.py</span></tt></a></li>
<li><a class="reference internal" href="#calculatorinterface-gemini-py">4.5.2. <tt class="docutils literal"><span class="pre">CalculatorInterface_GEMINI.py</span></tt></a></li>
<li><a class="reference internal" href="#gemini-keywords-py">4.5.3. <tt class="docutils literal"><span class="pre">GEMINI_Keywords.py</span></tt></a></li>
<li><a class="reference internal" href="#gemini-descriptors-py">4.5.4. <tt class="docutils literal"><span class="pre">GEMINI_Descriptors.py</span></tt></a></li>
<li><a class="reference internal" href="#instrument-keywords-py">4.5.5. <tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;_Keywords.py</span></tt></a></li>
<li><a class="reference internal" href="#instrument-descriptors-py">4.5.6. <tt class="docutils literal"><span class="pre">&lt;INSTRUMENT&gt;_Descriptors.py</span></tt></a></li>
<li><a class="reference internal" href="#mkcalculatorinterface">4.5.7. <tt class="docutils literal"><span class="pre">mkCalculatorInterface</span></tt></a></li>
<li><a class="reference internal" href="#descriptorslist-gemini-py">4.5.8. <tt class="docutils literal"><span class="pre">DescriptorsList_GEMINI.py</span></tt></a></li>
<li><a class="reference internal" href="#docstrings-py">4.5.9. <tt class="docutils literal"><span class="pre">docstrings.py</span></tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-add-a-new-gemini-descriptor">4.6. How to add a new Gemini descriptor</a></li>
<li><a class="reference internal" href="#descriptor-coding-guidelines">4.7. Descriptor Coding Guidelines</a></li>
<li><a class="reference internal" href="#descriptor-exceptions">4.8. Descriptor Exceptions</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="advancedusage.html"
                        title="previous chapter">3. Advanced Descriptor Usage</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="appendices/appendixA.html"
                        title="next chapter">A Complete List of Available Descriptors</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/coding.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="appendices/appendixA.html" title="A Complete List of Available Descriptors"
             >next</a> |</li>
        <li class="right" >
          <a href="advancedusage.html" title="3. Advanced Descriptor Usage"
             >previous</a> |</li>
        <li><a href="index.html">A User&#39;s Guide to Descriptors 1.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Emma Hogan.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>