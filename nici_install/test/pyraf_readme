# Before running Pyraf make sure you can load the
# NICI module from a python shell.
# To achieve this the PYTHONPATH should point to
# the installed NICI directory.

# Start pyraf
pyraf

#  set nicipath=<path_to_nici_scripts>/    #  Notice the ending '/'
set nicipath=/tmp/lib/python/nici/      # An example

# Define the pyraf task
task nici = nicipath$nici.cl

# Load the nici scripts
nici

# Now you have the nici scripts available in your Pyraf session.
# You can write 2) and 3) in your loginuser.cl so that after
# typing 'Pyraf' you only need to load the package.

mkdir /tmp/results         # your output directory

# Run the quick look tool
ncqlook('@/tmp/lib/python/test/in.lis',idir='/net/petrohue/dataflow',odir='/tmp/results')

# Generate Flats calibrations files:
# flat_blue.fits, flat_red.fits,
# sky_blue.fits and sky_red.fits.
#  Make a directory to hold the calibration files

mkdir /tmp/results/flats

ncmkflats  @/tmp/lib/python/test/flats.lis idir=/net/petrohue/dataflow odir=/tmp/results/flats

# Directory to hold the science files

mkdir /tmp/results/science

# Now find the mask centers and update the headers

ncprepare @/tmp/lib/python/test/object.lis idir=/net/petrohue/dataflow odir=/tmp/results/science


# Finally run the science reduction
lpar ncscience              # Pyraf command to see the parameters value

ncscience '/tmp/results/science/*.fits' odir=/tmp/results fdir=/tmp/results/flats suffix='S20090410'
