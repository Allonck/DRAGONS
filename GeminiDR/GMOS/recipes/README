README for GEMINI/GMOS primitive classes.

The hierarchy of the GEMINI/GMOS primitive classes:

    	            PrimitivesCORE(object)       -- pkg GEMINI
                              |
	        PrimitivesGemini(PrimitivesCORE)  -- pkg GEMINI
                              |
	        PrimitivesGMOS(PrimitivesGemini)
                  |                          |
    PrimitivesIMAGE(PrimitivesGMOS)  PrimitivesSPECT(PrimitivesGMOS)


================================================================================
Usage of this recipe library in the context of the prototype (New Hope) 
recipe system.

  In a pipeline context, the mamagement of imports and the AstroData 
  instance 'ad' falls under the purview of the reduce_alpha.py module and the 
  RecipeMapper class layer, which mediates the 'reduce' command line interface 
  and the primitive sets.

  However, because the new package structure provides direct programmatic access
  to primitives and parameter sets, the recipes herein are directly callable.

  Callers should set $PYTHONPATH to access the GeminiDR package, as in

  export PYTHONPATH=${PYTHONPATH}:/path/to/GeminiDR

  Dependencies: AstroData.

  Note: The PrimitivesIMAGE class is initialised with a *list* of astrodata
  objects. This is legacy behaviour and allows multiple FITS files to be
  passed on the command line. Under nominal use, as in the example below,
  this list will comprise one 'ad' object, an AstroData instance of the
  dataset indicated.

  E.g., in the python interpreter, one can import and use a recipe directly
  
  >>> from GMOS.primitives.primitives_GMOS import PrimitivesIMAGE
  >>> from astrodata import AstroData
  >>> ad = AstroData('S20150929S0151.fits')
  >>> gmos_primitives = PrimitivesIMAGE([ad])
  >>> from GMOS.recipes.QA.IMAGE import qaReduce
  >>> qaReduce(gmos_primitives)

  This recipe is a skeletonized version of the currently defined recipe of the 
  same name in the legacy QAP. Users should see output in the form below.

  Recall, this is a prototype demonstrating proof of concept. Most primitives are 
  pass throughs that simply show input datasets, and output file names appended 
  with a 'suffix' specified by parameter defaults. Each primitives display the 
  parameters available to it. The primitive ADUToElectrons is fully functional, 
  however, and does perform its nominal task.

>>> qaReduce(p)
   ------------------
   PRIMITIVE::prepare
   ------------------
      -----------------------
      PRIMITIVE::validateData
      -----------------------
      Parameters:
      {'repair': False, 'suffix': '_dataValidated'}
      S20150929S0151_dataValidated.fits
      -------------------------------
      PRIMITIVE::standardizeStructure
      -------------------------------
      Parameters:
      {'attach_mdf': False, 'mdf': None, 'suffix': '_structureStandardized'}
      S20150929S0151_structureStandardized.fits
      -----------------------------------
      PRIMITIVE::standardizeGeminiHeaders
      -----------------------------------
      Parameters:
      {'suffix': '_geminiHeadersStandardized'}
      S20150929S0151_geminiHeadersStandardized.fits
      ---------------------------------------
      PRIMITIVE::standardizeInstrumentHeaders
      ---------------------------------------
      Parameters:
      {'suffix': '_instrumentHeadersStandardized'}
      S20150929S0151_instrumentHeadersStandardized.fits
      -------------------------
      PRIMITIVE::markAsPrepared
      -------------------------
      Parameters:
      {'suffix': '_prepared'}
      S20150929S0151_prepared.fits
   ----------------
   PRIMITIVE::addDQ
   ----------------
   timestamp keyword: ADDDQ
   Parameters available on addDQ
   {'illum_mask': False, 'bpm': None, 'suffix': '_dqAdded'}
   working on ...
   S20150929S0151_prepared.fits
   S20150929S0151_dqAdded.fits
   {'read_noise': True}
   -----------------
   PRIMITIVE::addVAR
   -----------------
   Parameters available on addVAR
   {'poisson_noise': False, 'suffix': '_varAdded', 'read_noise': True}
   working on ...
   S20150929S0151_dqAdded.fits
   S20150929S0151_varAdded.fits
   ------------------------
   PRIMITIVE::detectSources
   ------------------------
   Parameters available on detectSources
   {'sigma': None, 'suffix': '_sourcesDetected', 'centroid_function': 'moffat', 'threshold': 3.0, 'mask': False, 'fwhm': None, 'method': 'sextractor', 'max_sources': 50, 'set_saturation': False}
   working on ...
   S20150929S0151_varAdded.fits
   PHU keyword GEM-TLM=2016-07-19T16:32:32 added to S20150929S0151_varAdded.fits
   PHU keyword DETECSRC=2016-07-19T16:32:32 added to S20150929S0151_varAdded.fits
   S20150929S0151_sourcesDetected.fits
   {'display': True}
   --------------------
   PRIMITIVE::measureIQ
   --------------------
   IQConstraints: 
   {'H': {'85': 0.85, '20': 0.4, '70': 0.6}, 'K': {'85': 0.8, '20': 0.35, '70': 0.55}, 'J': {'85': 0.85, '20': 0.4, '70': 0.6}, 'M': {'85': 0.7, '20': 0.35, '70': 0.5}, 'L': {'85': 0.75, '20': 0.35, '70': 0.5}, 'AO': {'85': 1.2, '20': 0.45, '70': 0.8}, 'N': {'85': 0.45, '20': 0.34, '70': 0.37}, 'Q': {'85': 0.54, '20': 0.54, '70': 0.54}, 'Y': {'85': 0.95, '20': 0.4, '70': 0.7}, 'X': {'85': 0.9, '20': 0.4, '70': 0.65}, 'Z': {'85': 0.95, '20': 0.5, '70': 0.7}, 'g': {'85': 1.1, '20': 0.6, '70': 0.85}, 'i': {'85': 1.05, '20': 0.5, '70': 0.75}, 'r': {'85': 1.05, '20': 0.5, '70': 0.75}, 'u': {'85': 1.2, '20': 0.6, '70': 0.9}}
   Parameters available on measureIQ
   {'separate_ext': False, 'remove_bias': True, 'suffix': '_iqMeasured', 'display': True}
   working on ...
   S20150929S0151_sourcesDetected.fits
   PHU keyword MEASREIQ=2016-07-19T16:32:32 added to S20150929S0151_sourcesDetected.fits
   PHU keyword GEM-TLM=2016-07-19T16:32:32 updated in S20150929S0151_sourcesDetected.fits
   S20150929S0151_iqMeasured.fits
   --------------------
   PRIMITIVE::measureBG
   --------------------
   BGConstraints: 
   {'Ks': {80: 14.6, 50: 14.6, 20: 14.6}, 'r': {80: 19.34, 50: 20.32, 20: 21.33}, 'u': {80: 17.48, 50: 19.49, 20: 21.66}, 'g': {80: 19.36, 50: 20.68, 20: 21.62}, 'i': {80: 19.3, 50: 19.97, 20: 20.44}, 'H': {80: 13.8, 50: 13.8, 20: 13.8}, 'J': {80: 16.2, 50: 16.2, 20: 16.2}, 'z': {80: 18.37, 50: 19.04, 20: 19.51}, 'K': {80: 14.6, 50: 14.6, 20: 14.6}}
   Parameters available on measureBG
   {'separate_ext': False, 'suffix': '_bgMeasured', 'remove_bias': True}
   working on ...
   S20150929S0151_iqMeasured.fits
   PHU keyword MEASREBG=2016-07-19T16:32:32 added to S20150929S0151_iqMeasured.fits
   PHU keyword GEM-TLM=2016-07-19T16:32:32 updated in S20150929S0151_iqMeasured.fits
   S20150929S0151_bgMeasured.fits
   ---------------------------------
   PRIMITIVE::measureCCAndAstrometry
   ---------------------------------
   Parameters available on measureCCAndAstrometry
   {'suffix': '_ccAndAstrometryMeasured', 'correct_wcs': False}
   working on ...
   S20150929S0151_bgMeasured.fits
   S20150929S0151_ccAndAstrometryMeasured.fits
      ------------------------------
      PRIMITIVE::addReferenceCatalog
      ------------------------------
      Parameters available on addReferenceCatalog
      {'source': 'gmos', 'radius': 0.067, 'suffix': '_refcatAdded'}
      working on ...
      S20150929S0151_ccAndAstrometryMeasured.fits
      PHU keyword ADDRECAT=2016-07-19T16:32:32 added to S20150929S0151_ccAndAstrometryMeasured.fits
      PHU keyword GEM-TLM=2016-07-19T16:32:32 updated in S20150929S0151_ccAndAstrometryMeasured.fits
      S20150929S0151_refcatAdded.fits
      --------------------
      PRIMITIVE::measureCC
      --------------------
      CCConstraints: 
      {'80': 1.0, '50': 0.08, '70': 0.3}
      Parameters available on measureCC
      {'suffix': '_ccMeasured'}
      working on ...
      S20150929S0151_refcatAdded.fits
      PHU keyword GEM-TLM=2016-07-19T16:32:32 updated in S20150929S0151_refcatAdded.fits
      PHU keyword MEASRECC=2016-07-19T16:32:32 added to S20150929S0151_refcatAdded.fits
      S20150929S0151_ccMeasured.fits
      ---------------------------------------
      PRIMITIVE::determineAstrometricSolution
      ---------------------------------------
      Parameters available on determineAstrometricSolution
      {'suffix': '_astrometryCorrected'}
      working on ...
      S20150929S0151_ccMeasured.fits
      PHU keyword ASTRMTRY=2016-07-19T16:32:32 added to S20150929S0151_ccMeasured.fits
      PHU keyword GEM-TLM=2016-07-19T16:32:32 updated in S20150929S0151_ccMeasured.fits
      S20150929S0151_astrometryCorrected.fits
   --------------------------
   PRIMITIVE::overscanCorrect
   --------------------------
   Parameters:
   None
   S20150929S0151.fits
      ---------------------------
      PRIMITIVE::subtractOverscan
      ---------------------------
      Parameters:
      {'suffix': '_overscanSubtracted', 'overscan_section': None}
      S20150929S0151_overscanSubtracted.fits
      -----------------------
      PRIMITIVE::trimOverscan
      -----------------------
      Parameters:
      {'suffix': '_overscanTrimmed'}
      S20150929S0151_overscanTrimmed.fits
   ----------------------
   PRIMITIVE::biasCorrect
   ----------------------
   Parameters:
   None
   S20150929S0151.fits
      ---------------------------
      PRIMITIVE::getProcessedBias
      ---------------------------
      Parameters available on getProcessedBias
      {'caltype': 'processed_bias'}
      working on ...
      S20150929S0151.fits
         {'caltype': 'processed_bias'}
         -------------------------
         PRIMITIVE::getCalibration
         -------------------------
         Parameters available on getCalibration
         {'source': 'all', 'caltype': 'processed_bias'}
         working on ...
         S20150929S0151.fits
      -----------------------
      PRIMITIVE::subtractBias
      -----------------------
      Parameters:
      {'bias': None, 'suffix': '_biasCorrected'}
      S20150929S0151_biasCorrected.fits
   -------------------------
   PRIMITIVE::ADUToElectrons
   -------------------------
   Converting S20150929S0151_biasCorrected.fits from ADU to electrons by multiplying by the gain
     gain for [SCI,1] = 1.834
     gain for [SCI,2] = 1.874
     gain for [SCI,3] = 1.878
     gain for [SCI,4] = 1.852
     gain for [SCI,5] = 1.908
     gain for [SCI,6] = 1.933
     gain for [SCI,7] = 1.84
     gain for [SCI,8] = 1.878
     gain for [SCI,9] = 1.813
     gain for [SCI,10] = 1.724
     gain for [SCI,11] = 1.761
     gain for [SCI,12] = 1.652
   SCI,1 keyword BUNIT=electron added to S20150929S0151_biasCorrected.fits
   SCI,2 keyword BUNIT=electron added to S20150929S0151_biasCorrected.fits
   SCI,3 keyword BUNIT=electron added to S20150929S0151_biasCorrected.fits
   SCI,4 keyword BUNIT=electron added to S20150929S0151_biasCorrected.fits
   SCI,5 keyword BUNIT=electron added to S20150929S0151_biasCorrected.fits
   SCI,6 keyword BUNIT=electron added to S20150929S0151_biasCorrected.fits
   SCI,7 keyword BUNIT=electron added to S20150929S0151_biasCorrected.fits
   SCI,8 keyword BUNIT=electron added to S20150929S0151_biasCorrected.fits
   SCI,9 keyword BUNIT=electron added to S20150929S0151_biasCorrected.fits
   SCI,10 keyword BUNIT=electron added to S20150929S0151_biasCorrected.fits
   SCI,11 keyword BUNIT=electron added to S20150929S0151_biasCorrected.fits
   SCI,12 keyword BUNIT=electron added to S20150929S0151_biasCorrected.fits
   PHU keyword GEM-TLM=2016-07-19T16:32:33 updated in S20150929S0151_biasCorrected.fits
   PHU keyword ADUTOELE=2016-07-19T16:32:33 added to S20150929S0151_biasCorrected.fits
   S20150929S0151_ADUToElectrons.fits
   {'poisson_noise': True}
   -----------------
   PRIMITIVE::addVAR
   -----------------
   Parameters available on addVAR
   {'poisson_noise': True, 'suffix': '_varAdded', 'read_noise': True}
   working on ...
   S20150929S0151_ADUToElectrons.fits
   S20150929S0151_varAdded.fits
   ----------------------
   PRIMITIVE::flatCorrect
   ----------------------
   Parameters:
   None
   S20150929S0151.fits
      ---------------------------
      PRIMITIVE::getProcessedBias
      ---------------------------
      Parameters available on getProcessedBias
      {'caltype': 'processed_bias'}
      working on ...
      S20150929S0151.fits
         {'caltype': 'processed_bias'}
         -------------------------
         PRIMITIVE::getCalibration
         -------------------------
         Parameters available on getCalibration
         {'source': 'all', 'caltype': 'processed_bias'}
         working on ...
         S20150929S0151.fits
      -----------------------
      PRIMITIVE::divideByFlat
      -----------------------
      Parameters available on divideByFlat
      {'flat': None, 'suffix': '_flatCorrected'}
      working on ...
      S20150929S0151.fits
      PHU keyword DIVFLAT=2016-07-19T16:32:33 added to S20150929S0151.fits
      PHU keyword GEM-TLM=2016-07-19T16:32:33 updated in S20150929S0151.fits
      S20150929S0151_flatCorrected.fits
   --------------------------
   PRIMITIVE::mosaicDetectors
   --------------------------
   Parameters:
   {'tile': False, 'interpolator': 'linear', 'suffix': '_mosaicked', 'interpolate_gaps': False}
   S20150929S0151_mosaicked.fits
   ---------------------
   PRIMITIVE::makeFringe
   ---------------------
   Parameters:
   {'subtract_median_image': False}
   S20150929S0151.fits
      --------------------------
      PRIMITIVE::makeFringeFrame
      --------------------------
      Parameters:
      {'reject_method': 'avsigclip', 'operation': 'median', 'suffix': '_fringe', 'subtract_median_image': True}
      S20150929S0151_fringe.fits
      -------------------------------
      PRIMITIVE::storeProcessedFringe
      -------------------------------
      Parameters available on storeProcessedFringe
      {'suffix': '_fringe'}
      working on ...
      S20150929S0151_fringe.fits
      S20150929S0151_fringe.fits
         ---------------------------
         PRIMITIVE::storeCalibration
         ---------------------------
         Parameters available on storeCalibration
         {'action': 'store'}
         working on ...
         S20150929S0151_fringe.fits
   ------------------------
   PRIMITIVE::fringeCorrect
   ------------------------
   Parameters:
   {'suffix': '_fringe'}
   S20150929S0151_fringe.fits
      -----------------------------
      PRIMITIVE::getProcessedFringe
      -----------------------------
      Parameters available on getProcessedFringe
      {'caltype': 'processed_fringe'}
      working on ...
      S20150929S0151_fringe.fits
         {'caltype': 'processed_fringe'}
         -------------------------
         PRIMITIVE::getCalibration
         -------------------------
         Parameters available on getCalibration
         {'source': 'all', 'caltype': 'processed_fringe'}
         working on ...
         S20150929S0151_fringe.fits
   ------------------------
   PRIMITIVE::detectSources
   ------------------------
   Parameters available on detectSources
   {'sigma': None, 'suffix': '_sourcesDetected', 'centroid_function': 'moffat', 'threshold': 3.0, 'mask': False, 'fwhm': None, 'method': 'sextractor', 'max_sources': 50, 'set_saturation': False}
   working on ...
   S20150929S0151_fringe.fits
   PHU keyword GEM-TLM=2016-07-19T16:32:33 updated in S20150929S0151_fringe.fits
   PHU keyword DETECSRC=2016-07-19T16:32:33 updated in S20150929S0151_fringe.fits
   S20150929S0151_sourcesDetected.fits
   {'display': True}
   --------------------
   PRIMITIVE::measureIQ
   --------------------
   IQConstraints: 
   {'H': {'85': 0.85, '20': 0.4, '70': 0.6}, 'K': {'85': 0.8, '20': 0.35, '70': 0.55}, 'J': {'85': 0.85, '20': 0.4, '70': 0.6}, 'M': {'85': 0.7, '20': 0.35, '70': 0.5}, 'L': {'85': 0.75, '20': 0.35, '70': 0.5}, 'AO': {'85': 1.2, '20': 0.45, '70': 0.8}, 'N': {'85': 0.45, '20': 0.34, '70': 0.37}, 'Q': {'85': 0.54, '20': 0.54, '70': 0.54}, 'Y': {'85': 0.95, '20': 0.4, '70': 0.7}, 'X': {'85': 0.9, '20': 0.4, '70': 0.65}, 'Z': {'85': 0.95, '20': 0.5, '70': 0.7}, 'g': {'85': 1.1, '20': 0.6, '70': 0.85}, 'i': {'85': 1.05, '20': 0.5, '70': 0.75}, 'r': {'85': 1.05, '20': 0.5, '70': 0.75}, 'u': {'85': 1.2, '20': 0.6, '70': 0.9}}
   Parameters available on measureIQ
   {'separate_ext': False, 'remove_bias': True, 'suffix': '_iqMeasured', 'display': True}
   working on ...
   S20150929S0151_sourcesDetected.fits
   PHU keyword MEASREIQ=2016-07-19T16:32:33 updated in S20150929S0151_sourcesDetected.fits
   PHU keyword GEM-TLM=2016-07-19T16:32:33 updated in S20150929S0151_sourcesDetected.fits
   S20150929S0151_iqMeasured.fits
   --------------------
   PRIMITIVE::measureBG
   --------------------
   BGConstraints: 
   {'Ks': {80: 14.6, 50: 14.6, 20: 14.6}, 'r': {80: 19.34, 50: 20.32, 20: 21.33}, 'u': {80: 17.48, 50: 19.49, 20: 21.66}, 'g': {80: 19.36, 50: 20.68, 20: 21.62}, 'i': {80: 19.3, 50: 19.97, 20: 20.44}, 'H': {80: 13.8, 50: 13.8, 20: 13.8}, 'J': {80: 16.2, 50: 16.2, 20: 16.2}, 'z': {80: 18.37, 50: 19.04, 20: 19.51}, 'K': {80: 14.6, 50: 14.6, 20: 14.6}}
   Parameters available on measureBG
   {'separate_ext': False, 'suffix': '_bgMeasured', 'remove_bias': True}
   working on ...
   S20150929S0151_iqMeasured.fits
   PHU keyword MEASREBG=2016-07-19T16:32:33 updated in S20150929S0151_iqMeasured.fits
   PHU keyword GEM-TLM=2016-07-19T16:32:33 updated in S20150929S0151_iqMeasured.fits
   S20150929S0151_bgMeasured.fits
   ---------------------------------
   PRIMITIVE::measureCCAndAstrometry
   ---------------------------------
   Parameters available on measureCCAndAstrometry
   {'suffix': '_ccAndAstrometryMeasured', 'correct_wcs': False}
   working on ...
   S20150929S0151_bgMeasured.fits
   S20150929S0151_ccAndAstrometryMeasured.fits
      ------------------------------
      PRIMITIVE::addReferenceCatalog
      ------------------------------
      Parameters available on addReferenceCatalog
      {'source': 'gmos', 'radius': 0.067, 'suffix': '_refcatAdded'}
      working on ...
      S20150929S0151_ccAndAstrometryMeasured.fits
      PHU keyword ADDRECAT=2016-07-19T16:32:33 updated in S20150929S0151_ccAndAstrometryMeasured.fits
      PHU keyword GEM-TLM=2016-07-19T16:32:33 updated in S20150929S0151_ccAndAstrometryMeasured.fits
      S20150929S0151_refcatAdded.fits
      --------------------
      PRIMITIVE::measureCC
      --------------------
      CCConstraints: 
      {'80': 1.0, '50': 0.08, '70': 0.3}
      Parameters available on measureCC
      {'suffix': '_ccMeasured'}
      working on ...
      S20150929S0151_refcatAdded.fits
      PHU keyword GEM-TLM=2016-07-19T16:32:33 updated in S20150929S0151_refcatAdded.fits
      PHU keyword MEASRECC=2016-07-19T16:32:33 updated in S20150929S0151_refcatAdded.fits
      S20150929S0151_ccMeasured.fits
      ---------------------------------------
      PRIMITIVE::determineAstrometricSolution
      ---------------------------------------
      Parameters available on determineAstrometricSolution
      {'suffix': '_astrometryCorrected'}
      working on ...
      S20150929S0151_ccMeasured.fits
      PHU keyword ASTRMTRY=2016-07-19T16:32:33 updated in S20150929S0151_ccMeasured.fits
      PHU keyword GEM-TLM=2016-07-19T16:32:33 updated in S20150929S0151_ccMeasured.fits
      S20150929S0151_astrometryCorrected.fits
   {'purpose': 'forStack'}
   --------------------
   PRIMITIVE::addToList
   --------------------
   Parameters available on addToList
   {'purpose': 'forStack'}
   working on ...
   S20150929S0151_astrometryCorrected.fits
   S20150929S0151.fits
