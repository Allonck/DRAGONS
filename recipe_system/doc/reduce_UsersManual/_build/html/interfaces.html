<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>3. Interfaces &mdash; Reduce Users Manual X1.0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/todo-styles.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'X1.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Reduce Users Manual X1.0.1 documentation" href="index.html" />
    <link rel="next" title="4. Supplemental tools" href="supptools.html" />
    <link rel="prev" title="2. Installation" href="userenv.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="supptools.html" title="4. Supplemental tools"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="userenv.html" title="2. Installation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Reduce Users Manual X1.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="interfaces">
<h1>3. Interfaces<a class="headerlink" href="#interfaces" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>3.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">reduce</span></tt> application provides a command line interface and an API, both
of which can configure and launch a Recipe System processing pipeline (a &#8216;recipe&#8217;)
on the input dataset. Control of <tt class="docutils literal"><span class="pre">reduce</span></tt> and the Recipe System is provided
by a variety of options and switches. Of course, all options and switches
can be accessed and controlled through the API.</p>
</div>
<div class="section" id="command-line-interface">
<h2>3.2. Command line interface<a class="headerlink" href="#command-line-interface" title="Permalink to this headline">¶</a></h2>
<p>We begin with the command line help provided by <tt class="docutils literal"><span class="pre">reduce</span> <span class="pre">--help</span></tt>, followed by
further description and discussion of certain non-trivial options that require
detailed explanation.</p>
<div class="highlight-python"><div class="highlight"><pre>usage: reduce [options] fitsfile [fitsfile ...]
</pre></div>
</div>
<p>positional arguments:</p>
<div class="highlight-python"><div class="highlight"><pre>fitsfile [fitsfile ...]
</pre></div>
</div>
<p>The [options] are described in the following sections.</p>
<div class="section" id="informational-switches">
<h3>3.2.1. Informational switches<a class="headerlink" href="#informational-switches" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong>-h, &#8211;help</strong></dt>
<dd>show the help message and exit</dd>
<dt><strong>-v, &#8211;version</strong></dt>
<dd>show program&#8217;s version number and exit</dd>
<dt><strong>-d, &#8211;displayflags</strong></dt>
<dd><p class="first">Display all parsed option flags and exit.</p>
<p>When specified, this switch will present the user with a table of all
parsed arguments and then exit without running. This allows the user to
check that the configuration is as intended. The table provides a convenient
view of all passed and default values. Unless a user has specified a
recipe (-r, &#8211;recipe), &#8216;recipename&#8217; indicates &#8216;None&#8217; because at this point,
the Recipe System has not yet been engaged and a default recipe not yet
determined.</p>
<p>Eg.,:</p>
<div class="last highlight-python"><div class="highlight"><pre>$ reduce -d --logmode console fitsfile.fits

--------------------   switches, vars, vals  --------------------

Literals                 var &#39;dest&#39;              Value
-----------------------------------------------------------------
[&#39;--invoked&#39;]            :: invoked              :: False
[&#39;--addprimset&#39;]         :: primsetname          :: None
[&#39;-d&#39;, &#39;--displayflags&#39;] :: displayflags         :: True
[&#39;-p&#39;, &#39;--param&#39;]        :: userparam            :: None
[&#39;--logmode&#39;]            :: logmode              :: [&#39;console&#39;]
[&#39;-r&#39;, &#39;--recipe&#39;]       :: recipename           :: None
[&#39;--throw_descriptor_exceptions&#39;] :: throwDescriptorExceptions :: False
[&#39;--logfile&#39;]            :: logfile              :: reduce.log
[&#39;-t&#39;, &#39;--astrotype&#39;]    :: astrotype            :: None
[&#39;--override_cal&#39;]       :: user_cals            :: None
[&#39;--context&#39;]            :: running_contexts     :: None
[&#39;--calmgr&#39;]             :: cal_mgr              :: None
[&#39;--suffix&#39;]             :: suffix               :: None
[&#39;--loglevel&#39;]           :: loglevel             :: stdinfo
-----------------------------------------------------------------

Input fits file(s):      fitsfile.fits
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="configuration-switches-options">
<span id="options"></span><h3>3.2.2. Configuration Switches, Options<a class="headerlink" href="#configuration-switches-options" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><strong>&#8211;addprimset &lt;PRIMSETNAME&gt;</strong></dt>
<dd>Add this path to user-supplied primitives for reduction. eg., path to a
primitives module.</dd>
<dt><strong>&#8211;calmgr &lt;CAL_MGR&gt;</strong></dt>
<dd>This is a URL specifying a calibration manager service. A calibration manager
overides Recipe System table. Not available outside Gemini operations.</dd>
<dt><strong>&#8211;context &lt;RUNNING_CONTEXTS&gt;</strong></dt>
<dd>Use &lt;RUNNING_CONTEXTS&gt; for primitives sensitive to context. Eg.,
<tt class="docutils literal"><span class="pre">--context</span> <span class="pre">QA</span></tt>. When not specified, the context defaults to &#8216;QA&#8217;.</dd>
<dt><strong>&#8211;invoked</strong></dt>
<dd>Boolean indicating that reduce was invoked by the control center.</dd>
<dt><strong>&#8211;logmode &lt;LOGMODE&gt;</strong></dt>
<dd><p class="first">Set logging mode. One of</p>
<ul class="simple">
<li>standard</li>
<li>console</li>
<li>quiet</li>
<li>debug</li>
<li>null</li>
</ul>
<p class="last">where &#8216;console&#8217; writes only to screen and &#8216;quiet&#8217; writes only to the log
file. Default is &#8216;standard&#8217;.</p>
</dd>
<dt><strong>&#8211;logfile &lt;LOGFILE&gt;</strong></dt>
<dd>Set the log file name. Default is &#8216;reduce.log&#8217; in the current directory.</dd>
<dt><strong>&#8211;loglevel &lt;LOGLEVEL&gt;</strong></dt>
<dd><p class="first">Set the verbose level for console logging. One of</p>
<ul class="simple">
<li>critical</li>
<li>error</li>
<li>warning</li>
<li>status</li>
<li>stdinfo</li>
<li>fullinfo</li>
<li>debug</li>
</ul>
<p class="last">Default setting is &#8216;stdinfo.&#8217;</p>
</dd>
<dt><strong>&#8211;override_cal &lt;USER_CALS [USER_CALS ...]&gt;</strong></dt>
<dd><p class="first">The option allows users to provide their own calibrations to <tt class="docutils literal"><span class="pre">reduce</span></tt>.
Add a calibration to User Calibration Service.
&#8216;&#8211;override_cal CALTYPE:CAL_PATH&#8217;
Eg.,</p>
<p class="last"><tt class="docutils literal"><span class="pre">--override_cal</span> <span class="pre">processed_arc:wcal/gsTest_arc.fits</span></tt></p>
</dd>
<dt><strong>-p &lt;USERPARAM [USERPARAM ...]&gt;, &#8211;param &lt;USERPARAM [USERPARAM ...]&gt;</strong></dt>
<dd><p class="first">Set a primitive parameter from the command line. The form &#8216;-p par=val&#8217; sets
the parameter in the reduction context such that all primitives will &#8216;see&#8217; it.
The form</p>
<p><tt class="docutils literal"><span class="pre">-p</span> <span class="pre">ASTROTYPE:primitivename:par=val</span></tt></p>
<p>sets the parameter such that it applies only when the current reduction type
(type of current reference image) is &#8216;ASTROTYPE&#8217; and the primitive is
&#8216;primitivename&#8217;. Separate parameter-value pairs by whitespace:
(eg. &#8216;-p par1=val1 par2=val2&#8217;)</p>
<p class="last">See Sec. <a class="reference internal" href="#userpars"><em>Overriding Primitive Parameters</em></a>, for more information on these values.</p>
</dd>
<dt><strong>-r &lt;RECIPENAME&gt;, &#8211;recipe &lt;RECIPENAME&gt;</strong></dt>
<dd>Specify an explicit recipe to be used rather than internally determined by
a dataset&#8217;s &lt;ASTROTYPE&gt;. Default is None and later determined by the Recipe
System based on the AstroDataType.</dd>
<dt><strong>-t &lt;ASTROTYPE&gt;, &#8211;astrotype &lt;ASTROTYPE&gt;</strong></dt>
<dd>Run a recipe based on this AstroDataType, which overrides default type or
begins without initial input. Eg., recipes that begin with primitives that
acquire data. <tt class="docutils literal"><span class="pre">reduce</span></tt> default is None and determined internally.</dd>
<dt><strong>&#8211;suffix &lt;SUFFIX&gt;</strong></dt>
<dd>Add &#8216;suffix&#8217; to output filenames at end of reduction.</dd>
<dt><strong>&#8211;throw_descriptor_exceptions</strong></dt>
<dd>Boolean indicating descriptor exceptions are to be raised. This is a
development switch.</dd>
</dl>
</div>
<div class="section" id="nominal-usage">
<h3>3.2.3. Nominal Usage<a class="headerlink" href="#nominal-usage" title="Permalink to this headline">¶</a></h3>
<p>The minimal call for reduce can be</p>
<div class="highlight-python"><div class="highlight"><pre>$ reduce &lt;dataset.fits&gt;
</pre></div>
</div>
<p>While this minimal call is available at the Gemini Observatory (see Sec.
<a class="reference internal" href="discuss.html#fitsstore"><em>Fits Storage</em></a>), if a calibration service is unavailable to the user &#8211;
likely true for most users &#8211; users should call <tt class="docutils literal"><span class="pre">reduce</span></tt> on a specified
dataset by providing calibration files with the  &#8211;overrride_cal option.</p>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre>$ reduce --override_cal processed_bias:FOO_bias.fits &lt;dataset.fits&gt;
</pre></div>
</div>
<p>Such a command for complex processing of data is possible because AstroData
and the Recipe System do all the necessary work in determining how the data are to
be processed, which is critcially based upon the determination of the <cite>typeset</cite>
that applies to that data.</p>
<p>Without any user-specified recipe (-r &#8211;recipe), the default recipe is
<tt class="docutils literal"><span class="pre">qaReduce</span></tt>, which is defined for various AstroDataTypes and currently used
during summit operations. The Recipe System uses a combination of index,
AstroDataTypes, and recipe naming convention to identify the appropriate
recipe to run.</p>
<p>The <tt class="docutils literal"><span class="pre">qaReduce</span></tt> recipe for a GMOS_IMAGE, named <tt class="docutils literal"><span class="pre">recipe.qaReduce.GMOS_IMAGE</span></tt>,
specifies that the following primitives are called on the data</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">prepare</span>
<span class="n">addDQ</span>
<span class="n">addVAR</span>
<span class="n">detectSources</span>
<span class="n">measureIQ</span>
<span class="n">measureBG</span>
<span class="n">measureCCAndAstrometry</span>
<span class="n">overscanCorrect</span>
<span class="n">biasCorrect</span>
<span class="n">ADUToElectrons</span>
<span class="n">addVAR</span>
<span class="n">flatCorrect</span>
<span class="n">mosaicDetectors</span>
<span class="n">makeFringe</span>
<span class="n">fringeCorrect</span>
<span class="n">detectSources</span>
<span class="n">measureIQ</span>
<span class="n">measureBG</span>
<span class="n">measureCCAndAstrometry</span>
<span class="n">addToList</span>
</pre></div>
</div>
<p>The point here is not to overwhelm readers with a stack of primitive names, but
to present both the default pipeline processing that the above simple <tt class="docutils literal"><span class="pre">reduce</span></tt>
command invokes and to demonstrate how much the <tt class="docutils literal"><span class="pre">reduce</span></tt> interface abstracts
away the complexity of the processing that is engaged with the simplicity of
commands.</p>
</div>
<div class="section" id="overriding-primitive-parameters">
<span id="userpars"></span><h3>3.2.4. Overriding Primitive Parameters<a class="headerlink" href="#overriding-primitive-parameters" title="Permalink to this headline">¶</a></h3>
<p>In some cases, users may wish to change the functional behaviour of certain
processing steps, i.e. change default behaviour of primitive
functions.</p>
<p>Each primitive has a set of pre-defined parameters, which are used to control
functional behaviour of the primitive. Each defined parameter has a &#8220;user
override&#8221; token, which indicates that a particular parameter may be overridden
by the user. Users can adjust parameter values from the reduce command line with
the option,</p>
<blockquote>
<div><strong>-p, &#8211;param</strong></div></blockquote>
<p>If permitted by the &#8220;user override&#8221; token, parameters and values specified
through the <strong>-p, &#8211;param</strong> option will <cite>override</cite> the defined
parameter default value and may alter default behaviour of the primitive
accessing this parameter. A user may pass several parameter-value pairs with
this option.</p>
<p>Eg.:</p>
<div class="highlight-python"><div class="highlight"><pre>$ reduce -p par1=val1 par2=val2 [par3=val3 ... ] &lt;fitsfile1.fits&gt;
</pre></div>
</div>
<p>For example, some photometry primitives perform source detection on an image.
The &#8216;detection threshold&#8217; has a defined default, but a user may alter this
parameter default to change the source detection behaviour:</p>
<div class="highlight-python"><div class="highlight"><pre>$ reduce -p threshold=4.5 &lt;fitsfile.fits&gt;
</pre></div>
</div>
</div>
<div class="section" id="the-file-facility">
<span id="atfile"></span><h3>3.2.5. The &#64;file facility<a class="headerlink" href="#the-file-facility" title="Permalink to this headline">¶</a></h3>
<p>The reduce command line interface supports what might be called an &#8216;at-file&#8217;
facility (users and readers familiar with IRAF will recognize this facility).
This facility allows users to provide any and all command line options and flags
to <tt class="docutils literal"><span class="pre">reduce</span></tt> via in a single acsii text file.</p>
<p>By passing an &#64;file to <tt class="docutils literal"><span class="pre">reduce</span></tt> on the command line, users can encapsulate all
the options and positional arguments they might wish to specify in a single
&#64;file. It is possible to use multiple &#64;files and even to embed one or more
&#64;files in another. The parser opens all files sequentially and parses
all arguments in the same manner as if they were specified on the command line.
Essentially, an &#64;file is some or all of the command line and parsed identically.</p>
<p>To illustrate the convenience provided by an <a class="reference external" href="mailto:'&#37;&#52;&#48;file">'<span>&#64;</span>file</a>&#8216;, let us begin with an
example <cite>reduce</cite> command line that has a number of arguments:</p>
<div class="highlight-python"><div class="highlight"><pre>$ reduce -p GMOS_IMAGE:contextReport:tpar=100 GMOS_IMAGE:contextReport:report_inputs=True
  -r recipe.ArgsTest --context qa S20130616S0019.fits N20100311S0090.fits
</pre></div>
</div>
<p>Ungainly, to be sure. Here, two (2) <cite>user parameters</cite> are being specified
with <strong>-p</strong>, a <cite>recipe</cite> with <strong>-r</strong>, and a <cite>context</cite> argument is specified
to be <strong>qa</strong> . This can be wrapped in a plain text &#64;file called
<cite>reduce_args.par</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre>S20130616S0019.fits
N20100311S0090.fits
--param
GMOS_IMAGE:contextReport:tpar=100
GMOS_IMAGE:contextReport:report_inputs=True
-r recipe.ArgsTests
--context qa
</pre></div>
</div>
<p>This then turns the previous reduce command line into something a little more
<cite>keyboard friendly</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ reduce @reduce_args.par
</pre></div>
</div>
<p>The order of these arguments is irrelevant. The parser will figure out what is
what. The above file could be thus written like:</p>
<div class="highlight-python"><div class="highlight"><pre>-r recipe.ArgsTests
--param
GMOS_IMAGE:contextReport:tpar=100
GMOS_IMAGE:contextReport:report_inputs=True
--context qa
S20130616S0019.fits
N20100311S0090.fits
</pre></div>
</div>
<p>Comments are accommodated, both as full line and in-line with the <tt class="docutils literal"><span class="pre">#</span></tt>
character.  White space is the only significant separator of arguments: spaces,
tabs, newlines are all equivalent when argument parsing.  This means
the user can &#8220;arrange&#8221; their &#64;file for clarity.</p>
<p>Here&#8217;s a more readable version of the file from the previous example
using comments and tabulation:</p>
<div class="highlight-python"><div class="highlight"><pre># reduce parameter file
# yyyy-mm-dd
# GDPSG

# Spec the recipe
-r
    recipe.ArgsTests  # test recipe

# primitive parameters here
# These are &#39;untyped&#39;, i.e. global
--param
    tpar=100
    report_inputs=True

--context
    qa                # QA context

S20130616S0019.fits
N20100311S0090.fits
</pre></div>
</div>
<p>All the above  examples of <tt class="docutils literal"><span class="pre">reduce_args.par</span></tt> are equivalently parsed, which
users may check by adding the <strong>-d</strong> flag:</p>
<div class="highlight-python"><div class="highlight"><pre>$ reduce -d @redpars.par

--------------------   switches, vars, vals  --------------------

Literals                      var &#39;dest&#39;              Value
-----------------------------------------------------------------
[&#39;--invoked&#39;]                 :: invoked              :: False
[&#39;--addprimset&#39;]              :: primsetname          :: None
[&#39;-d&#39;, &#39;--displayflags&#39;]      :: displayflags         :: True
[&#39;-p&#39;, &#39;--param&#39;]             :: userparam            :: [&#39;tpar=100&#39;, &#39;report_inputs=True&#39;]
[&#39;--logmode&#39;]                 :: logmode              :: standard
[&#39;-r&#39;, &#39;--recipe&#39;]            :: recipename           :: [&#39;recipe.ArgTests&#39;]
[&#39;--throw_descriptor_exceptions&#39;] :: throwDescriptorExceptions        :: False
[&#39;--logfile&#39;]                 :: logfile              :: reduce.log
[&#39;-t&#39;, &#39;--astrotype&#39;]         :: astrotype            :: None
[&#39;--override_cal&#39;]            :: user_cals            :: None
[&#39;--context&#39;]                 :: running_contexts     :: [&#39;QA&#39;]
[&#39;--calmgr&#39;]                  :: cal_mgr              :: None
[&#39;--suffix&#39;]                  :: suffix               :: None
[&#39;--loglevel&#39;]                :: loglevel             :: stdinfo
-----------------------------------------------------------------

Input fits file(s):   S20130616S0019.fits
Input fits file(s):   N20100311S0090.fits
</pre></div>
</div>
</div>
<div class="section" id="recursive-file-processing">
<h3>3.2.6. Recursive &#64;file processing<a class="headerlink" href="#recursive-file-processing" title="Permalink to this headline">¶</a></h3>
<p>As implemented, the &#64;file facility will recursively handle, and process
correctly, other &#64;file specifications that appear in a passed &#64;file or
on the command line. For example, we may have another file containing a
list of fits files, separating the command line flags from the positional
arguments.</p>
<p>We have a plain text &#8216;fitsfiles&#8217; containing the line:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">test_data</span><span class="o">/</span><span class="n">S20130616S0019</span><span class="o">.</span><span class="n">fits</span>
</pre></div>
</div>
<p>We can indicate that this file is to be consumed with the prefix character
&#8220;&#64;&#8221; as well. In this case, the &#8216;reduce_args.par&#8217; file could thus appear:</p>
<div class="highlight-python"><div class="highlight"><pre># reduce test parameter file

@fitsfiles       # file with fits files

# AstroDataType
-t GMOS_IMAGE

# primitive parameters.
--param
    report_inputs=True
    tpar=99
    FOO=BAR

# Spec the recipe
-r recipe.ArgTests
</pre></div>
</div>
<p>The parser will open and read the &#64;fitsfiles, consuming those lines in the
same way as any other command line arguments. Indeed, such a file need not only
contain fits files (positional arguments), but other arguments as well. This is
recursive. That is, the &#64;fitsfiles can contain other at-files&#8221;, which can contain
other &#8220;at-files&#8221;, which can contain ..., etc. These will be processed
serially.</p>
<p>As stipulated earlier, because the &#64;file facility provides arguments equivalent
to those that appear on the command line, employment of this facility means that
a reduce command line could assume the form:</p>
<div class="highlight-python"><div class="highlight"><pre>$ reduce @parfile @fitsfiles
</pre></div>
</div>
<p>or equally:</p>
<div class="highlight-python"><div class="highlight"><pre>$ reduce @fitsfiles @parfile
</pre></div>
</div>
<p>where &#8216;parfile&#8217; could contain the flags and user parameters, and &#8216;fitsfiles&#8217;
could contain a list of datasets.</p>
<p>Eg., fitsfiles comprises the one line:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">test_data</span><span class="o">/</span><span class="n">N20100311S0090</span><span class="o">.</span><span class="n">fits</span>
</pre></div>
</div>
<p>while parfile holds all other specifications:</p>
<div class="highlight-python"><div class="highlight"><pre># reduce test parameter file
# GDPSG

# AstroDataType
-t GMOS_IMAGE

# primitive parameters.
--param
    report_inputs=True
    tpar=99            # This is a test parameter
    FOO=BAR            # This is a test parameter

# Spec the recipe
-r recipe.ArgTests
</pre></div>
</div>
<p>The &#64;file does not need to be located in the current directory.  Normal,
directory path syntax applies, for example:</p>
<div class="highlight-python"><div class="highlight"><pre>reduce @../../mydefaultparams @fitsfile
</pre></div>
</div>
</div>
<div class="section" id="overriding-file-values">
<h3>3.2.7. Overriding &#64;file values<a class="headerlink" href="#overriding-file-values" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">reduce</span></tt> application employs a customized command line parser such that
the command line option</p>
<p><strong>-p</strong> or <strong>&#8211;param</strong></p>
<p>will accumulate a set of parameters <cite>or</cite> override a particular parameter.
This may be seen when a parameter is specified in a user &#64;file and then
specified on the command line. For unitary value arguments, the command line
value will <cite>override</cite> the &#64;file value.</p>
<p>It is further specified that if one or more datasets (i.e. positional arguments)
are passed on the command line, <cite>all fits files appearing as positional arguments</cite>
<cite>in the parameter file will be replaced by the command line arguments.</cite></p>
<p>Using the parfile above,</p>
<p>Eg. 1)  Accumulate a new parameter:</p>
<div class="highlight-python"><div class="highlight"><pre>$ reduce @parfile --param FOO=BARSOOM

parsed options:
---------------
AstroDataType: GMOS_IMAGE
FITS files:    [&#39;S20130616S0019.fits&#39;, &#39;N20100311S0090.fits&#39;]
Parameters:    tpar=100, report_inputs=True, FOO=BARSOOM
RECIPE:        recipe.ArgsTest
</pre></div>
</div>
<p>Eg. 2) Override a parameter in the &#64;file:</p>
<div class="highlight-python"><div class="highlight"><pre>$ reduce @parfile --param tpar=99

parsed options:
---------------
AstroDataType: GMOS_IMAGE
FITS files:    [&#39;S20130616S0019.fits&#39;, &#39;N20100311S0090.fits&#39;]
Parameters:    tpar=99, report_inputs=True
RECIPE:        recipe.ArgsTest
</pre></div>
</div>
<p>Eg. 3) Override the recipe:</p>
<div class="highlight-python"><div class="highlight"><pre>$ reduce @parfile -r=recipe.FOO

parsed options:
---------------
AstroDataType: GMOS_IMAGE
FITS files:    [&#39;S20130616S0019.fits&#39;, &#39;N20100311S0090.fits&#39;]
Parameters:    tpar=100, report_inputs=True
RECIPE:        recipe.FOO
</pre></div>
</div>
<p>Eg. 4) Override a recipe and specify another fits file. The file names in
the &#64;file will be ignored:</p>
<div class="highlight-python"><div class="highlight"><pre>$ reduce @parfile -r=recipe.FOO test_data/N20100311S0090_1.fits

parsed options:
---------------
AstroDataType: GMOS_IMAGE
FITS files:    [&#39;test_data/N20100311S0090_1.fits&#39;]
Parameters:    tpar=100, report_inputs=True
RECIPE:        recipe.FOO
</pre></div>
</div>
</div>
</div>
<div class="section" id="application-programming-interface-api">
<h2>3.3. Application Programming Interface (API)<a class="headerlink" href="#application-programming-interface-api" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section describes and discusses the programmatic interface
available on the class Reduce.  This section is for advanced
users wishing to code using the <tt class="docutils literal"><span class="pre">Reduce</span></tt> class, rather than using
<tt class="docutils literal"><span class="pre">reduce</span></tt> at the command line.</p>
</div>
<p>The <tt class="docutils literal"><span class="pre">reduce</span></tt> application is essentially a skeleton script providing the
described command line interface. After parsing the command line, the script
then passes the parsed arguments to its main() function, which in turn calls
the Reduce() class constructor with &#8220;args&#8221;. The Reduce class is scriptable by
any user as the following discussion illustrates.</p>
<div class="section" id="class-reduce-logging-and-the-runr-method">
<h3>3.3.1. Class Reduce, logging, and the runr() method<a class="headerlink" href="#class-reduce-logging-and-the-runr-method" title="Permalink to this headline">¶</a></h3>
<p>The Reduce class is defined under the <tt class="docutils literal"><span class="pre">gemini_python</span></tt> code base in the
<tt class="docutils literal"><span class="pre">recipe_system.reduction</span></tt> module, <tt class="docutils literal"><span class="pre">coreReduce.py</span></tt>.</p>
<p>The Reduce() class is importable and provides settable attributes and a callable
that can be used programmatically. Callers need not supply an &#8220;args&#8221; parameter
to the class initializer, i.e. __init__(). An instance of Reduce will have all
the same arguments as in a command line scenario, available as attributes on the
instance. Once an instance of Reduce() is instantiated and instance attributes
set as needed, there is one (1) method to call, <strong>runr()</strong>. This is the only
public method on the class.</p>
<p>Eg.,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">recipe_system.reduction.coreReduce</span> <span class="kn">import</span> <span class="n">Reduce</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span> <span class="o">=</span> <span class="n">Reduce</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span><span class="o">.</span><span class="n">files</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;S20130616S0019.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span><span class="o">.</span><span class="n">files</span>
<span class="go">[&#39;S20130616S0019.fits&#39;]</span>
</pre></div>
</div>
<p>Or callers may simply set the <tt class="docutils literal"><span class="pre">files</span></tt> attribute to be an existing list of files</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fits_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;FOO.fits&#39;</span><span class="p">,</span> <span class="s">&#39;BAR.fits&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="n">fits_list</span>
</pre></div>
</div>
<p>On the command line, users may specify a recipe with the <tt class="docutils literal"><span class="pre">-r</span></tt> [ <tt class="docutils literal"><span class="pre">--recipe</span></tt> ]
flag. Programmatically, users directly set the recipe:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span><span class="o">.</span><span class="n">recipename</span> <span class="o">=</span> <span class="s">&#39;recipe.MyRecipe&#39;</span>
</pre></div>
</div>
<p>All other properties and  attributes on the API may be set in standard pythonic
ways. See Appendix
<a class="reference internal" href="appendices/reduce_properties.html#props"><em>Class Reduce: Settable properties and attributes</em></a> for further
discussion and more examples.</p>
<div class="section" id="using-the-logger">
<h4>3.3.1.1. Using the logger<a class="headerlink" href="#using-the-logger" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When using an instance of Reduce() directly, callers must configure
their own logger. Reduce() does not configure logutils prior to using
a logger as returned by logutils.get_logger(). The following discussion
demonstrates how this is easily done. It is <cite>highly recommended</cite>
that callers configure the logger.</p>
</div>
<p>It is recommended that callers of Reduce use a logger supplied by the astrodata
module <tt class="docutils literal"><span class="pre">logutils</span></tt>. This module employs the python logger module, but with
recipe system specific features and embellishments. The recipe system
expects to have access to a logutils logger object, which callers should provide
prior to calling the <tt class="docutils literal"><span class="pre">runr()</span></tt> method.</p>
<p>To use <tt class="docutils literal"><span class="pre">logutils</span></tt>, import, configure, and get it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">astrodata.utils</span> <span class="kn">import</span> <span class="n">logutils</span>
<span class="n">logutils</span><span class="o">.</span><span class="n">config</span><span class="p">()</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">logutils</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">__name__</span></tt> is usually the calling module&#8217;s __name__ property, but can
be any string value. Once configured and instantiated, the <tt class="docutils literal"><span class="pre">log</span></tt> object is
ready to use. See section <a class="reference internal" href="#options"><em>Configuration Switches, Options</em></a> for logging levels described on the
<tt class="docutils literal"><span class="pre">--loglevel</span></tt> option.</p>
<p>Once an instance of Reduce has been made, callers may (should) configure the
logutils facility with attributes available on the instance. Instances of
<tt class="docutils literal"><span class="pre">Reduce()</span></tt> provide the following logger parameters as attributes on the
instance with appropriate default values:</p>
<table class="hlist"><tr><td><ul class="simple">
<li>logfile</li>
<li>loglevel</li>
<li>logmode</li>
<li>logindent</li>
</ul>
</td></tr></table>
<p>The <tt class="docutils literal"><span class="pre">reduce</span></tt> command line provides access to the first three of these
attributes, as described in Sec. <a class="reference internal" href="#options"><em>Configuration Switches, Options</em></a>, but <tt class="docutils literal"><span class="pre">logindent</span></tt>, which
controls the indention levels of logging output, is accessible only through the
public interface on an instance of <tt class="docutils literal"><span class="pre">Reduce()</span></tt>. It is not anticipated that users
will need, or even want, to change the value of <tt class="docutils literal"><span class="pre">logindent</span></tt>, but it is possible.</p>
<p>An instance of <tt class="docutils literal"><span class="pre">Reduce()</span></tt> provides the following attributes that may be passed
to the <tt class="docutils literal"><span class="pre">logutils.config()</span></tt>. The default values provided for these logging
configuration parameters may be examined through direct inspection:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span> <span class="o">=</span> <span class="n">Reduce</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span><span class="o">.</span><span class="n">logfile</span>
<span class="go">&#39;reduce.log&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span><span class="o">.</span><span class="n">logmode</span>
<span class="go">&#39;standard&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span><span class="o">.</span><span class="n">loglevel</span>
<span class="go">&#39;stdinfo&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span><span class="o">.</span><span class="n">logindent</span>
<span class="go">3</span>
</pre></div>
</div>
<p>Users may adjust these values and then pass them to the <tt class="docutils literal"><span class="pre">logutils.config()</span></tt>
function, or pass other values directly to <tt class="docutils literal"><span class="pre">config()</span></tt>. This is precisely what
<tt class="docutils literal"><span class="pre">reduce</span></tt> does when it configures logutils. See Sec. <a class="reference internal" href="#options"><em>Configuration Switches, Options</em></a>  and
Appendix <a class="reference internal" href="appendices/reduce_properties.html#props"><em>Class Reduce: Settable properties and attributes</em></a> for
allowable and default values of these and other options.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astrodata.utils</span> <span class="kn">import</span> <span class="n">logutils</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logutils</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="nb">reduce</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="nb">reduce</span><span class="o">.</span><span class="n">logmode</span><span class="p">,</span>
<span class="go">                    console_lvl=reduce.loglevel)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">logutils.config() may be called mutliply, should callers, for example,
want to change logfile names for different calls on runr().</p>
</div>
</div>
<div class="section" id="call-the-runr-method">
<h4>3.3.1.2. Call the runr() method<a class="headerlink" href="#call-the-runr-method" title="Permalink to this headline">¶</a></h4>
<p>Once a user is satisfied that all attributes are set to the desired values, and
the logger is configured, the runr() method on the &#8220;reduce&#8221; instance may then be
called. The following brings the examples above into one &#8220;end-to-end&#8221; use of
Reduce and logutils:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">recipe_system.reduction.coreReduce</span> <span class="kn">import</span> <span class="n">Reduce</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astrodata.utils</span> <span class="kn">import</span> <span class="n">logutils</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span> <span class="o">=</span> <span class="n">Reduce</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;S20130616S0019.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span><span class="o">.</span><span class="n">recipename</span> <span class="o">=</span> <span class="s">&#39;recipe.MyRecipe&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="s">&#39;my_reduce_run.log&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logutils</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="nb">reduce</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="nb">reduce</span><span class="o">.</span><span class="n">logmode</span><span class="p">,</span>
<span class="go">                    console_lvl=reduce.loglevel)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span><span class="o">.</span><span class="n">runr</span><span class="p">()</span>
<span class="go">All submitted files appear valid</span>
<span class="go">Starting Reduction on set #1 of 1</span>
<span class="go">Processing dataset(s):</span>
<span class="go">S20130616S0019.fits</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>Processing will then proceed in the usual manner. Astute readers will note that
callers need not create more than one Reduce instance in order to call runr()
with a different dataset or options.</p>
<p>Eg.,:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">recipe_system.reduction.coreReduce</span> <span class="kn">import</span> <span class="n">Reduce</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astrodata.utils</span> <span class="kn">import</span> <span class="n">logutils</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span> <span class="o">=</span> <span class="n">Reduce</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;S20130616S0019.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span><span class="o">.</span><span class="n">recipename</span> <span class="o">=</span> <span class="s">&#39;recipe.MyRecipe&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="s">&#39;my_reduce_run.log&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logutils</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="nb">reduce</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="nb">reduce</span><span class="o">.</span><span class="n">logmode</span><span class="p">,</span>
<span class="go">                     console_lvl=reduce.loglevel)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span><span class="o">.</span><span class="n">runr</span><span class="p">()</span>
<span class="go">  ...</span>
<span class="go">reduce completed successfully.</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span><span class="o">.</span><span class="n">recipename</span> <span class="o">=</span> <span class="s">&#39;recipe.NewRecipe&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;newfile.fits&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span><span class="o">.</span><span class="n">userparam</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;clobber=True&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">runr</span><span class="p">()</span>
</pre></div>
</div>
<p>Once an attribute is set on an instance, such as above with <tt class="docutils literal"><span class="pre">userparam</span></tt>, it is
always set on the instance. If, on another call of runr() the caller does not
wish to have <tt class="docutils literal"><span class="pre">clobber=True</span></tt>, simply reset the property:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span><span class="o">.</span><span class="n">userparam</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">runr</span><span class="p">()</span>
</pre></div>
</div>
<p>Readers may wish to examine the examples in Appendix
<a class="reference internal" href="appendices/reduce_properties.html#props"><em>Class Reduce: Settable properties and attributes</em></a></p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3. Interfaces</a><ul>
<li><a class="reference internal" href="#introduction">3.1. Introduction</a></li>
<li><a class="reference internal" href="#command-line-interface">3.2. Command line interface</a><ul>
<li><a class="reference internal" href="#informational-switches">3.2.1. Informational switches</a></li>
<li><a class="reference internal" href="#configuration-switches-options">3.2.2. Configuration Switches, Options</a></li>
<li><a class="reference internal" href="#nominal-usage">3.2.3. Nominal Usage</a></li>
<li><a class="reference internal" href="#overriding-primitive-parameters">3.2.4. Overriding Primitive Parameters</a></li>
<li><a class="reference internal" href="#the-file-facility">3.2.5. The &#64;file facility</a></li>
<li><a class="reference internal" href="#recursive-file-processing">3.2.6. Recursive &#64;file processing</a></li>
<li><a class="reference internal" href="#overriding-file-values">3.2.7. Overriding &#64;file values</a></li>
</ul>
</li>
<li><a class="reference internal" href="#application-programming-interface-api">3.3. Application Programming Interface (API)</a><ul>
<li><a class="reference internal" href="#class-reduce-logging-and-the-runr-method">3.3.1. Class Reduce, logging, and the runr() method</a><ul>
<li><a class="reference internal" href="#using-the-logger">3.3.1.1. Using the logger</a></li>
<li><a class="reference internal" href="#call-the-runr-method">3.3.1.2. Call the runr() method</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="userenv.html"
                        title="previous chapter">2. Installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="supptools.html"
                        title="next chapter">4. Supplemental tools</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/interfaces.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="supptools.html" title="4. Supplemental tools"
             >next</a> |</li>
        <li class="right" >
          <a href="userenv.html" title="2. Installation"
             >previous</a> |</li>
        <li><a href="index.html">Reduce Users Manual X1.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Kenneth Anderson.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>